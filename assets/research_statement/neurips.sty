% Modified LaTeX2e package based on NeurIPS style for long-horizon writing:
%
% - uses NeurIPS formatting conventions for consistency
% - optimized for extended documents and weekly progress logs
% - removes submission-specific constraints
% - maintains clean, academic formatting
% - supports flexible document structure
% - loads natbib automatically; this can be suppressed with the
%   [nonatbib] package option
% - no conference-specific notices or restrictions
%
% Based on neurips_2024.sty by Roman Garnett (garnett@wustl.edu) and contributors
% Modified for long-horizon writing
%
% last revision: October 2024

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{neurips}[2024/10/14 NeurIPS-style formatting for long-horizon writing]

% declare clean option for minimal formatting
\newif\if@clean\@cleanfalse
\DeclareOption{clean}{
  \@cleantrue
}

% declare nonatbib option, which does not load natbib in case of
% package clash (users can pass options to natbib via
% \PassOptionsToPackage)
\newif\if@natbib\@natbibtrue
\DeclareOption{nonatbib}{
  \@natbibfalse
}

% declare numbered sections option
\newif\if@numberedsections\@numberedsectionstrue
\DeclareOption{nonumbered}{
  \@numberedsectionsfalse
}

\ProcessOptions\relax

% fonts
\renewcommand{\rmdefault}{ptm}
\renewcommand{\sfdefault}{phv}

% document information (can be customized)
\newcommand{\@documenttype}{Research Notes}
\newcommand{\@documentyear}{\the\year}
\newcommand{\setdocumenttype}[1]{\renewcommand{\@documenttype}{#1}}
\newcommand{\setdocumentyear}[1]{\renewcommand{\@documentyear}{#1}}

% acknowledgments
\usepackage{environ}
\newcommand{\acksection}{\section*{Acknowledgments}}
\NewEnviron{ack}{%
  \acksection
  \BODY
}


% load natbib unless told otherwise
\if@natbib
  \RequirePackage{natbib}
\fi

% set page geometry - more flexible for long documents
\usepackage[verbose=true,letterpaper]{geometry}
\AtBeginDocument{
  \newgeometry{
    textheight=9.5in,
    textwidth=6.0in,
    top=0.75in,
    headheight=12pt,
    headsep=25pt,
    footskip=30pt
  }
  \@ifpackageloaded{fullpage}
    {\PackageWarning{neurips}{fullpage package not recommended! Using custom formatting.}}
    {}
}

\widowpenalty=10000
\clubpenalty=10000
\flushbottom
\sloppy


% font sizes with reduced leading
\renewcommand{\normalsize}{%
  \@setfontsize\normalsize\@xpt\@xipt
  \abovedisplayskip      7\p@ \@plus 2\p@ \@minus 5\p@
  \abovedisplayshortskip \z@ \@plus 3\p@
  \belowdisplayskip      \abovedisplayskip
  \belowdisplayshortskip 4\p@ \@plus 3\p@ \@minus 3\p@
}
\normalsize
\renewcommand{\small}{%
  \@setfontsize\small\@ixpt\@xpt
  \abovedisplayskip      6\p@ \@plus 1.5\p@ \@minus 4\p@
  \abovedisplayshortskip \z@  \@plus 2\p@
  \belowdisplayskip      \abovedisplayskip
  \belowdisplayshortskip 3\p@ \@plus 2\p@   \@minus 2\p@
}
\renewcommand{\footnotesize}{\@setfontsize\footnotesize\@ixpt\@xpt}
\renewcommand{\scriptsize}{\@setfontsize\scriptsize\@viipt\@viiipt}
\renewcommand{\tiny}{\@setfontsize\tiny\@vipt\@viipt}
\renewcommand{\large}{\@setfontsize\large\@xiipt{14}}
\renewcommand{\Large}{\@setfontsize\Large\@xivpt{16}}
\renewcommand{\LARGE}{\@setfontsize\LARGE\@xviipt{20}}
\renewcommand{\huge}{\@setfontsize\huge\@xxpt{23}}
\renewcommand{\Huge}{\@setfontsize\Huge\@xxvpt{28}}

% sections with less space
\providecommand{\section}{}
\renewcommand{\section}{%
  \@startsection{section}{1}{\z@}%
                {-2.0ex \@plus -0.5ex \@minus -0.2ex}%
                { 1.5ex \@plus  0.3ex \@minus  0.2ex}%
                {\large\bf\raggedright}%
}
\providecommand{\subsection}{}
\renewcommand{\subsection}{%
  \@startsection{subsection}{2}{\z@}%
                {-1.8ex \@plus -0.5ex \@minus -0.2ex}%
                { 0.8ex \@plus  0.2ex}%
                {\normalsize\bf\raggedright}%
}
\providecommand{\subsubsection}{}
\renewcommand{\subsubsection}{%
  \@startsection{subsubsection}{3}{\z@}%
                {-1.5ex \@plus -0.5ex \@minus -0.2ex}%
                { 0.5ex \@plus  0.2ex}%
                {\normalsize\bf\raggedright}%
}
\providecommand{\paragraph}{}
\renewcommand{\paragraph}{%
  \@startsection{paragraph}{4}{\z@}%
                {1.5ex \@plus 0.5ex \@minus 0.2ex}%
                {-1em}%
                {\normalsize\bf}%
}
\providecommand{\subparagraph}{}
\renewcommand{\subparagraph}{%
  \@startsection{subparagraph}{5}{\z@}%
                {1.5ex \@plus 0.5ex \@minus 0.2ex}%
                {-1em}%
                {\normalsize\bf}%
}
\providecommand{\subsubsubsection}{}
\renewcommand{\subsubsubsection}{%
  \vskip5pt{\noindent\normalsize\rm\raggedright}%
}

% float placement
\renewcommand{\topfraction      }{0.85}
\renewcommand{\bottomfraction   }{0.4}
\renewcommand{\textfraction     }{0.1}
\renewcommand{\floatpagefraction}{0.7}

\newlength{\@neuripsabovecaptionskip}\setlength{\@neuripsabovecaptionskip}{7\p@}
\newlength{\@neuripsbelowcaptionskip}\setlength{\@neuripsbelowcaptionskip}{\z@}

\setlength{\abovecaptionskip}{\@neuripsabovecaptionskip}
\setlength{\belowcaptionskip}{\@neuripsbelowcaptionskip}

% swap above/belowcaptionskip lengths for tables
\renewenvironment{table}
  {\setlength{\abovecaptionskip}{\@neuripsbelowcaptionskip}%
   \setlength{\belowcaptionskip}{\@neuripsabovecaptionskip}%
   \@float{table}}
  {\end@float}

% footnote formatting
\setlength{\footnotesep }{6.65\p@}
\setlength{\skip\footins}{9\p@ \@plus 4\p@ \@minus 2\p@}
\renewcommand{\footnoterule}{\kern-3\p@ \hrule width 12pc \kern 2.6\p@}
\setcounter{footnote}{0}

% paragraph formatting
\setlength{\parindent}{\z@}
\setlength{\parskip  }{5.5\p@}

% list formatting
\setlength{\topsep       }{4\p@ \@plus 1\p@   \@minus 2\p@}
\setlength{\partopsep    }{1\p@ \@plus 0.5\p@ \@minus 0.5\p@}
\setlength{\itemsep      }{2\p@ \@plus 1\p@   \@minus 0.5\p@}
\setlength{\parsep       }{2\p@ \@plus 1\p@   \@minus 0.5\p@}
\setlength{\leftmargin   }{3pc}
\setlength{\leftmargini  }{\leftmargin}
\setlength{\leftmarginii }{2em}
\setlength{\leftmarginiii}{1.5em}
\setlength{\leftmarginiv }{1.0em}
\setlength{\leftmarginv  }{0.5em}
\def\@listi  {\leftmargin\leftmargini}
\def\@listii {\leftmargin\leftmarginii
              \labelwidth\leftmarginii
              \advance\labelwidth-\labelsep
              \topsep  2\p@ \@plus 1\p@    \@minus 0.5\p@
              \parsep  1\p@ \@plus 0.5\p@ \@minus 0.5\p@
              \itemsep \parsep}
\def\@listiii{\leftmargin\leftmarginiii
              \labelwidth\leftmarginiii
              \advance\labelwidth-\labelsep
              \topsep    1\p@ \@plus 0.5\p@ \@minus 0.5\p@
              \parsep    \z@
              \partopsep 0.5\p@ \@plus 0\p@ \@minus 0.5\p@
              \itemsep \topsep}
\def\@listiv {\leftmargin\leftmarginiv
              \labelwidth\leftmarginiv
              \advance\labelwidth-\labelsep}
\def\@listv  {\leftmargin\leftmarginv
              \labelwidth\leftmarginv
              \advance\labelwidth-\labelsep}
\def\@listvi {\leftmargin\leftmarginvi
              \labelwidth\leftmarginvi
              \advance\labelwidth-\labelsep}

% create title - simplified for long documents
\providecommand{\maketitle}{}
\renewcommand{\maketitle}{%
  \par
  \begingroup
    \renewcommand{\thefootnote}{\fnsymbol{footnote}}
    % for perfect author name centering
    \renewcommand{\@makefnmark}{\hbox to \z@{$^{\@thefnmark}$\hss}}
    % The footnote-mark was overlapping the footnote-text,
    % added the following to fix this problem               (MK)
    \long\def\@makefntext##1{%
      \parindent 1em\noindent
      \hbox to 1.8em{\hss $\m@th ^{\@thefnmark}$}##1
    }
    \if@clean
      \thispagestyle{empty}
    \else
      \thispagestyle{plain}
    \fi
    \@maketitle
    \@thanks
  \endgroup
  \let\maketitle\relax
  \let\thanks\relax
}

% rules for title box at top of first page
\newcommand{\@toptitlebar}{
  \hrule height 4\p@
  \vskip 0.25in
  \vskip -\parskip%
}
\newcommand{\@bottomtitlebar}{
  \vskip 0.29in
  \vskip -\parskip
  \hrule height 1\p@
  \vskip 0.09in%
}

% create title formatting - flexible for different document types
\providecommand{\@maketitle}{}
\renewcommand{\@maketitle}{%
  \vbox{%
    \hsize\textwidth
    \linewidth\hsize
    \vskip 0.1in
    \if@clean
      % minimal title formatting
      \centering
      {\LARGE\bf \@title\par}
      \vskip 0.2in
      \ifx\@author\@empty\else
        \def\And{%
          \end{tabular}\vskip 0.3em \begin{tabular}[t]{c}%
        }%
        \def\AND{%
          \end{tabular}\hskip 1em \begin{tabular}[t]{c}%
        }%
        \begin{tabular}[t]{c}\bf\rule{\z@}{24\p@}\@author\end{tabular}%
        \vskip 0.3in \@minus 0.1in
      \fi
    \else
      % styled title formatting with rules (NeurIPS style)
      \@toptitlebar
      \centering
      {\LARGE\bf \@title\par}
      \@bottomtitlebar
      \ifx\@author\@empty\else
        \def\And{%
          \end{tabular}\vskip 0.3em \begin{tabular}[t]{c}%
        }%
        \def\AND{%
          \end{tabular}\hskip 1em \begin{tabular}[t]{c}%
        }%
        \begin{tabular}[t]{c}\bf\rule{\z@}{24\p@}\@author\end{tabular}%
        \vskip 0.3in \@minus 0.1in
      \fi
    \fi
  }
}

% add optional document info footer
\newcommand{\ftype@infobox}{8}
\newcommand{\@docinfo}{%
  \if@clean\else
    \@float{infobox}[b]%
      \footnotesize\@documenttype\ -- \@documentyear%
    \end@float%
  \fi
}

% abstract styling
\renewenvironment{abstract}%
{%
  \vskip 0.075in%
  \centerline%
  {\large\bf Abstract}%
  \vspace{0.5ex}%
  \begin{quote}%
}
{
  \par%
  \end{quote}%
  \vskip 1ex%
}

% For progress tracking and notes
% These commands require xcolor and amssymb packages loaded by user
\@ifpackageloaded{xcolor}{%
  \newcommand{\progressYes}[1][]{\textcolor{green}{$\checkmark$\ #1}}
  \newcommand{\progressNo}[1][]{\textcolor{red}{$\times$\ #1}}
  \newcommand{\progressPartial}[1][]{\textcolor{orange}{$\circ$\ #1}}
  \newcommand{\progressTODO}[1][]{\textcolor{red}{\bf [TODO] #1}}
  \newcommand{\note}[1]{\textcolor{blue}{\textit{Note: #1}}}
}{%
  \newcommand{\progressYes}[1][]{$\checkmark$\ #1}
  \newcommand{\progressNo}[1][]{$\times$\ #1}
  \newcommand{\progressPartial}[1][]{$\circ$\ #1}
  \newcommand{\progressTODO}[1][]{\bf [TODO] #1}
  \newcommand{\note}[1]{\textit{Note: #1}}
}
\newcommand{\week}[1]{\subsection*{Week of #1}}

% For long document organization
\newenvironment{summary}{%
  \section*{Summary}
  \begin{quote}
}{%
  \end{quote}
}

\newenvironment{objectives}{%
  \section*{Objectives}
  \begin{enumerate}
}{%
  \end{enumerate}
}

\newenvironment{progress}{%
  \section*{Progress}
}{%
}

\newenvironment{nextweek}{%
  \section*{Next Week}
  \begin{enumerate}
}{%
  \end{enumerate}
}

% Add support for headers and footers in long documents
% Only set up fancyhdr if not using clean option
\if@clean
  % For clean option, use simple page numbering
  \let\ps@plain\ps@empty
  \def\ps@plain{%
    \let\@oddhead\@empty
    \let\@evenhead\@empty
    \def\@oddfoot{\hfil\thepage\hfil}%
    \let\@evenfoot\@oddfoot
  }
  \pagestyle{plain}
\else
  % For styled documents, use fancyhdr
  \RequirePackage{fancyhdr}
  \pagestyle{fancy}
  \fancyhf{} % clear all header and footer fields
  % \fancyhead[L]{\small\leftmark}
  \fancyhead[R]{\small\@documenttype}
  \fancyfoot[C]{\thepage}
  \renewcommand{\headrulewidth}{0.4pt}
  \renewcommand{\footrulewidth}{0pt}
\fi

% Add table of contents formatting for long documents (optional)
\AtBeginDocument{%
  \@ifpackageloaded{tocloft}{%
    \renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}}
    \setlength{\cftbeforesecskip}{0.3em}
  }{}
}

% Set table of contents depth to include subsubsections
\setcounter{tocdepth}{3}

% Add improved section numbering control
\if@numberedsections\else
  \setcounter{secnumdepth}{0}
\fi


\endinput
